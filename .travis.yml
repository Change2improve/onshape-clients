matrix:
  include:
    - language: python
      stage: test_cli
      python: 3.7
      install:
        # START TESTING THE CLI
        - cd cli
        - pip install pipenv
        - pipenv install --dev
      script:
        - pipenv run pytest
        # END TESTING THE CLI
        - cd ..
        - pip install ./cli
        - which onshape-clients
    - language: python
      stage: test_clients
      python: 3.7
      install:
        - pip install ./cli
        - onshape-clients install
      script:
        - onshape-clients test
    - language: node_js
      stage: deploy
      node_js: 12
      install:
        - pyenv install 3.6.3
        - pyenv global 3.6.3
        - pip install ./cli
        - which onshape-clients
        - npm install --dev
      script:
        - npx semantic-release
stages:
  - test_cli
  - test_clients
  - deploy
before_install:
  - openssl aes-256-cbc -K $encrypted_823a8aeaad18_key -iv $encrypted_823a8aeaad18_iv
    -in secrets.sh.enc -out secrets.sh -d
  - source environment.sh
